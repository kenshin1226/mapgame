<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>
<body>
    <canvas id="gameCanvas" width="800" height="600"></canvas>
    <script>
        const canvas = document.getElementById("gameCanvas");
        const ctx = canvas.getContext("2d");
        const image = new Image();
        image.src = "img/man1.png";
        const image2 =new Image();
        image2.src="img/green.png";
        const image3 =new Image();
        image3.src="img/sea.png";
        const image4 =new Image();
        image4.src="img/stone.png";
        let movingLeft=false
        let movingRight=false
        let movingup=false
        let movingdown=false
 
        const map=[[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],
        [1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],
        [1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],
        [1,1,1,1,3,3,1,1,1,1,1,1,1,1,1,1],
        [1,1,1,3,1,1,1,1,1,1,1,1,1,1,1,1],
        [1,1,3,1,1,1,1,1,1,1,1,1,1,1,1,1],
        [1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],
        [1,1,1,1,1,1,1,1,2,2,2,1,1,1,1,1],
        [1,1,1,1,1,1,1,1,1,2,2,2,2,2,1,1],
        [1,1,1,1,1,1,1,1,1,1,1,2,2,2,2,1],
        [1,1,1,1,1,1,1,1,1,1,1,1,2,2,2,2],
        [1,1,1,1,1,1,1,1,1,1,1,1,2,2,2,2],
        ]
        const f1=(e) => {
            if (e.key === 'ArrowLeft') {
                movingLeft = true;
            }
            if (e.key === 'ArrowRight') {
                movingRight = true;
            }
            if (e.key === 'ArrowUp'){
                movingup = true;
            }
            if (e.key === 'ArrowDown'){
                movingdown = true;
            }
        }
        // キーボードイベントリスナー
        window.addEventListener('keydown',f1 );

        window.addEventListener('keyup', (e) => {
            if (e.key === 'ArrowLeft') {
                movingLeft = false;
            }
            if (e.key === 'ArrowRight') {
                movingRight = false;
            }
            if (e.key === 'ArrowUp'){
                movingup = false;
            }
            if (e.key === 'ArrowDown'){
                movingdown = false;
            }
        });

        class Player {
            constructor(x, y, size, image) {
                this.x = x;
                this.y = y;
                this.x2=x/50
                this.y2=y/50 
                this.size=size
                this.image=image
            }
            draw(){
                let oldx=this.x
                let oldy=this.y
                

                ctx.drawImage(
                    this.image,
                    0, 0, 100, 100, // 切り取る部分の (sx, sy, sw, sh)
                    this.x, this.y, 80, 80 // 描画する位置とサイズ (dx, dy, dw, dh)
                );
            if (movingLeft==true){
                this.x=this.x-50
            }
            if(movingRight==true){
                this.x=this.x+50
            }
            if (movingup==true){
                this.y=this.y-50
            }
            if(movingdown==true){
                this.y=this.y+50
            }

            if(this.x>750){
                this.x=750
            }
            else if(this.x<0){
                this.x=0
            };
            if(this.y>550){
                this.y=550
            }
            else if(this.y<0){
                this.y=0
            };


            this.x2=this.x/50
            this.y2=this.y/50 

            console.log("this.x2="+this.x2)
            console.log("this.y2="+this.y2)
            if(map[this.x2][this.y2]===2){
                this.x=oldx
                this.y=oldy
            }
            else if(map[this.x2][this.y2]===3){
                this.x=oldx
                this.y=oldy
            };
            }

        }
        const P1=new Player(100,100,50,image)

        function draw_flame(){
            ctx.clearRect(0, 0, canvas.width, canvas.height); // 画面クリア
            // 画像がロードされたら描画
            // image.onload = function() {
            // 直線を描く
            // ctx.beginPath();
            // ctx.moveTo(lx, 300); // 始点
            // ctx.lineTo(lx+100, 300); // 終点
            // ctx.strokeStyle = "black"; // 線の色
            // ctx.lineWidth = 10; // 線の太さ
            // ctx.stroke(); // 線を描画
            
            for(let i=0;i<12;i++){
              for(let u=0;u<16;u++){
                if(map[i][u]==1){
                ctx.drawImage(
                    image2,
                    0, 0, 50, 50, // 切り取る部分の (sx, sy, sw, sh)
                    u*50, i*50,50, 50 // 描画する位置とサイズ (dx, dy, dw, dh)
                );
                };
                if(map[i][u]==2){
                ctx.drawImage(
                    image3,
                    0, 0, 50, 50, // 切り取る部分の (sx, sy, sw, sh)
                    u*50, i*50,50, 50 // 描画する位置とサイズ (dx, dy, dw, dh)
                );
                };
                if(map[i][u]==3){
                ctx.drawImage(
                    image4,
                    0, 0, 50, 50, // 切り取る部分の (sx, sy, sw, sh)
                    u*50, i*50,50, 50 // 描画する位置とサイズ (dx, dy, dw, dh)
                );
                };
              }  
            }
            P1.draw();
            
       
       

            requestAnimationFrame(draw_flame)
        };

        image.onload = function() {
        draw_flame();
        };
        
    </script>
</body>
</html>